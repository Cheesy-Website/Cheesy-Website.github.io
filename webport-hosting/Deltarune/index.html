<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css">
  <script>
    setTimeout(function() {
        document.title = "Home | Schoology";
        document.querySelector("link[rel='icon']").href = "https://i.ibb.co/NY8yC9c/download-1.png";
    }, 3500);
  </script>
  
  <script>
    window.onbeforeunload = function() {
        const cookies = document.cookie.split(';');
        let warningEnabled = false;
        cookies.forEach(cookie => {
            const [name, value] = cookie.trim().split('=');
            if (name === 'warningEnabled') {
                warningEnabled = (value === 'true');
            }
        });
        if (warningEnabled) {
            return "Are you sure you want to leave this page?";
        }
    };
  </script>
  
  <script>
    window.onload = function() {
        const cookies = document.cookie.split(';');
        let userKey = '';
        let userLink = '';
        
        cookies.forEach(cookie => {
            if (cookie.trim().startsWith('userKey=')) {
                userKey = cookie.split('=')[1];
            }
            if (cookie.trim().startsWith('userLink=')) {
                userLink = cookie.split('=')[1];
            }
        });

        document.addEventListener('keydown', function(event) {
            if (event.key === userKey) {
                window.open(userLink, "_blank");
            }
        });
    };
  </script>
  
  <style>
    /* Console styles */
    #console-wrapper {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 300px;
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      font-family: monospace;
      font-size: 14px;
      display: none;
      z-index: 9999;
      padding: 10px;
      box-sizing: border-box;
      overflow-y: auto;
    }

    #console-header {
      background: #444;
      padding: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    #console-output {
      height: calc(100% - 30px);
      overflow-y: auto;
      padding: 5px;
      white-space: pre-wrap;
    }

    #console-input {
      width: 100%;
      background: transparent;
      border: none;
      color: #fff;
      font-size: 14px;
      outline: none;
      padding: 5px;
    }

    #console-input:focus {
      outline: none;
    }
  </style>
  
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Create console elements
    const consoleWrapper = document.createElement('div');
    consoleWrapper.id = 'console-wrapper';
    consoleWrapper.style.display = 'none'; // hidden initially
    document.body.appendChild(consoleWrapper);

    const consoleHeader = document.createElement('div');
    consoleHeader.id = 'console-header';
    consoleHeader.textContent = 'Console (Click to Hide)';
    consoleWrapper.appendChild(consoleHeader);

    const consoleOutput = document.createElement('div');
    consoleOutput.id = 'console-output';
    consoleWrapper.appendChild(consoleOutput);

    const consoleInput = document.createElement('input');
    consoleInput.id = 'console-input';
    consoleInput.placeholder = 'Type a command...';
    consoleWrapper.appendChild(consoleInput);

    let consoleVisible = false;

    // Toggle console
    function toggleConsole() {
      consoleVisible = !consoleVisible;
      consoleWrapper.style.display = consoleVisible ? 'block' : 'none';
      if (consoleVisible) consoleInput.focus();
    }

    consoleHeader.addEventListener('click', toggleConsole);

    // Execute commands
    consoleInput.addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        const command = consoleInput.value.trim();
        if (!command) return;
        const outputLine = document.createElement('div');
        outputLine.textContent = '> ' + command;
        consoleOutput.appendChild(outputLine);

        try {
          const result = eval(command);
          if (result !== undefined) {
            const resultLine = document.createElement('div');
            resultLine.textContent = 'Result: ' + result;
            consoleOutput.appendChild(resultLine);
          }
        } catch (e) {
          const errorLine = document.createElement('div');
          errorLine.textContent = 'Error: ' + e.message;
          consoleOutput.appendChild(errorLine);
        }

        consoleOutput.scrollTop = consoleOutput.scrollHeight;
        consoleInput.value = '';
      }
    });

    // Toggle console with Ctrl + Backquote (`) â€” works on all layouts
    document.addEventListener('keydown', (event) => {
      if (event.ctrlKey && event.code === 'Backquote') {
        event.preventDefault(); // prevent weird scrolling
        toggleConsole();
      }
    });
  });
</script>

</head>

<body>
  <div class="logo-container">
    <img src="logo.png" alt="Logo" class="logo">
  </div>
  
  <div class="menu">
    <a>NOTE: To fix the screen being stretched, press F4 (or on Chromebook, hold the search key and press the fullscreen button, which is the fourth key to the right of the ESC key)</a>
    <a href="javascript:loadChapter(1)" class="row">
      <span class="chapter">Chapter 1</span>
      <span class="title">The Beginning</span>
      <img src="icons/1.png">
    </a>
    <a href="javascript:loadChapter(2)" class="row">
      <span class="chapter">Chapter 2</span>
      <span class="title">A Cyber's World</span>
      <img src="icons/2.png">
    </a>
    <a href="javascript:loadChapter(3)" class="row">
      <span class="chapter">Chapter 3</span>
      <span class="title">Late Night</span>
      <img src="icons/3.png">
    </a>
    <a href="javascript:loadChapter(4)" class="row">
      <span class="chapter">Chapter 4</span>
      <span class="title">Prophecy</span>
      <img src="icons/4.png">
    </a>
    <a href="javascript:alert('Chapter 5 coming soon!')" class="disabled-row">
      <span class="chapter">Chapter 5</span>
      <span class="disabled-title">--</span>
      <img src="icons/0.png">
    </a>
    <a href="javascript:alert('Chapter 6 coming soon!')" class="disabled-row">
      <span class="chapter">Chapter 6</span>
      <span class="disabled-title">--</span>
      <img src="icons/0.png">
    </a>
    <a href="javascript:alert('Chapter 7 coming soon!')" class="disabled-row">
      <span class="chapter">Chapter 7</span>
      <span class="disabled-title">--</span>
      <img src="icons/0.png">
    </a>
  </div>

  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-WLTG1S4STB');
  </script>

  <audio id="drone" controls loop autoplay hidden>
    <source src="audios/AUDIO_DRONE.ogg" type="audio/ogg">
    Your browser does not support the audio element.
  </audio>
  <button id="mute">ðŸ”Š</button>
  
  <script>
    const audio = document.getElementById('drone');
    const mute = document.getElementById('mute');
    let gamestarted = false;
  
    mute.addEventListener('click', () => {
      if (!gamestarted) {
        audio.muted = !audio.muted;
        updateButton(); 
      }
    });
  
    function updateButton() {
      if (!gamestarted) {
        mute.textContent = audio.muted ? 'ðŸ”Š' : 'ðŸ”‡';
      }
    }
  
    updateButton();

    function loadChapter(chapter) {
      fetch(`chapter${chapter}/index.html`).then(res => res.text()).then(html => {
        gamestarted = true;
        document.documentElement.innerHTML = html;
        document.documentElement.querySelectorAll('script').forEach(oldScript => {
          const newScript = document.createElement('script');
          if (oldScript.src) {
            newScript.src = oldScript.src;
          } else {
            newScript.textContent = oldScript.textContent;
          }
          document.body.appendChild(newScript);
        });
      });
    }

    const menumoveaudio = new Audio('audios/snd_menumove.mp3');
    const menuselectaudio = new Audio('audios/snd_select.mp3');
    
    document.querySelectorAll('.row').forEach(row => {
      row.addEventListener('mouseenter', () => {
        if (!gamestarted) {
          menumoveaudio.play();
          if (selectedChapter) {
            document.querySelectorAll('.row')[selectedChapter].classList.remove("selected");
          }
        }
      });
      
      row.addEventListener('click', () => {
        if (!gamestarted) {
          menuselectaudio.play();
        }
      });
    });

    let selectedChapter = null;
    document.addEventListener('keydown', function(event) {
      if (!gamestarted) {
        if (event.key === 'ArrowUp') {
          if (selectedChapter === null) {
            selectedChapter = 0;
            document.querySelectorAll('.row')[0].classList.add("selected");
            menumoveaudio.play();
          } else {
            document.querySelectorAll('.row')[selectedChapter].classList.remove("selected");
            selectedChapter--;
            if (selectedChapter < 0) {
              selectedChapter = document.querySelectorAll('.row').length - 1;
            }
            document.querySelectorAll('.row')[selectedChapter].classList.add("selected");
            menumoveaudio.play();
          }
        } else if (event.key === 'ArrowDown') {
          if (selectedChapter === null) {
            selectedChapter = 0;
            document.querySelectorAll('.row')[0].classList.add("selected");
            menumoveaudio.play();
          } else {
            if (selectedChapter+1 >= document.querySelectorAll('.row').length) {
              document.querySelectorAll('.row')[selectedChapter].classList.remove("selected");
              selectedChapter = 0;
              document.querySelectorAll('.row')[0].classList.add("selected");
              menumoveaudio.play();
            } else {
              document.querySelectorAll('.row')[selectedChapter].classList.remove("selected");
              selectedChapter++;
              document.querySelectorAll('.row')[selectedChapter].classList.add("selected");
              menumoveaudio.play();
            }
          }
        } else if (event.key === 'Enter') {
          if (selectedChapter !== null) {
            window.location.href = document.querySelectorAll('.row')[selectedChapter].href;
            menuselectaudio.play();
          } 
        }
      }
    });
  </script>
</body>
</html>
